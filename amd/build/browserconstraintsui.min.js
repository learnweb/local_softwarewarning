define("local_softwarewarning/browserconstraintsui",["exports","core/templates"],(function(_exports,_templates){var obj;
/**
   * Manages the Admin browser constraints ui
   *
   * @module     local_softwarewarning/browserconstraintsui
   * @copyright  2022 Justus Dieckmann WWU
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */let anchor,configroot,bannertypes;function getAncestorWithClass(node,theclass){for(;!node.classList.contains(theclass);){if(null===node.parentElement)return null;node=node.parentElement}return node}async function renderTemplate(template,context){const html=await _templates.default.render(template,context),div=document.createElement("div");return div.innerHTML=html,div.firstElementChild}async function appendEmptyBrowserElement(){const node=await renderTemplate("local_softwarewarning/browserconfig_browser",{banners:bannertypes,browsername:"",issinglerule:!1,singlebanner:"unrecognized",multirulebanners:[{version:"",banner:"unrecognized"}]});configroot.appendChild(node)}async function appendEmptyVersionElement(parentElement){const node=await renderTemplate("local_softwarewarning/browserconfig_version",{banners:bannertypes,version:"",banner:"unrecognized"});parentElement.appendChild(node)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=async function(_config,_bannertypes){bannertypes=_bannertypes,anchor=document.getElementById("local_softwarewarning-anchor");const root=await async function(config){const context=function(config){const browsers=[];for(let browser in config){const versions=config[browser],versionsArr=[];for(let version in versions)"all"!==version&&versionsArr.push({version:version,banner:versions[version]});versionsArr.push({version:"",banner:"unrecognized"}),browsers.push({browsername:browser,issinglerule:!!versions.all,singlebanner:versions.all,multirulebanners:versionsArr})}return browsers.push({browsername:"",issinglerule:!1,singlebanner:"unrecognized",multirulebanners:[{version:"",banner:"unrecognized"}]}),{banners:bannertypes,browsers:browsers}}(config);return await renderTemplate("local_softwarewarning/browserconfig",context)}(_config);configroot=root.querySelector("#local_softwarewarning-config");root.querySelector("#local_softwarewarning-save").onclick=()=>{const configjson=JSON.stringify(function(){const config={};for(let browserdom of configroot.children){const browser=browserdom.querySelector('input[data-sw-type="name"]').value;if(0===browser.length)continue;let versions={};if("true"===browserdom.getAttribute("data-sw-singlerule"))versions.all=browserdom.querySelector('select[data-sw-type="singlerule"]').value;else{const anchor=browserdom.querySelector(".sw-multirule-anchor");for(let versiondom of anchor.children){const version=parseInt(versiondom.querySelector('input[data-sw-type="multi-version"]').value);isNaN(version)||(versions[version]=versiondom.querySelector('select[data-sw-type="multi-banner"]').value)}}config[browser]=versions}return config}()),form=document.createElement("form");form.method="post",form.action="";let input=document.createElement("input");input.name="sesskey",input.value=M.cfg.sesskey,form.appendChild(input),input=document.createElement("input"),input.name="json",input.value=configjson,form.appendChild(input),document.body.appendChild(form),form.submit()};const selectEls=configroot.querySelectorAll("*[data-sw-selected]");for(let selectEl of selectEls)selectEl.value=selectEl.getAttribute("data-sw-selected");configroot.oninput=async e=>{const target=e.target,type=target.getAttribute("data-sw-type"),browserelement=getAncestorWithClass(target,"sw-browser");switch(type){case"name":{const isEmpty=0===target.value.length;browserelement.setAttribute("data-sw-empty",isEmpty),isEmpty||null!==browserelement.nextElementSibling||await appendEmptyBrowserElement();break}case"issinglerule":browserelement.setAttribute("data-sw-singlerule",target.checked);break;case"multi-version":{const misEmpty=0===target.value.length,versionelement=getAncestorWithClass(target,"sw-version");versionelement.setAttribute("data-sw-empty",misEmpty),misEmpty||null!==versionelement.nextElementSibling||await appendEmptyVersionElement(versionelement.parentElement);break}}},configroot.onclick=async e=>{const versionAncestor=getAncestorWithClass(e.target,"sw-delete-version");if(null!==versionAncestor){const swverion=getAncestorWithClass(versionAncestor,"sw-version"),parent=swverion.parentElement;swverion.remove(),"true"!==parent.lastElementChild.getAttribute("data-sw-empty")&&await appendEmptyVersionElement(parent)}else{const browserAncestor=getAncestorWithClass(e.target,"sw-delete-browser");null!==browserAncestor&&(getAncestorWithClass(browserAncestor,"sw-browser").remove(),"true"!==configroot.lastElementChild.getAttribute("data-sw-empty")&&await appendEmptyBrowserElement())}},anchor.appendChild(root)},_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj}}));

//# sourceMappingURL=browserconstraintsui.min.js.map